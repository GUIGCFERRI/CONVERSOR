SELECT PRODUTO.PROCOD AS COD_FABRICANTE,
PRODUTO.PRODES AS DESCRICAO,
SECAO.SECDES AS GRUPO,
PRODUTO.TRBID AS ST,
PRODUTO.PROUNID AS UND,
PRODUTO.PROPRCVDAVAR AS PRECO_VENDA,
PRODUTO.PROPRCCST AS PRECO_CUSTO,
PRODUTO.PRODATCADINC AS DATA_CADASTRO,
PRODUTO.PRODATCADALT AS ALTERACAO_PRECO,
PRODUTO.PROEND AS CARACTERISTICAS,
PRODUTO.PROUNDCMP AS UND_COMPRA,
PRODUTO.PROPRCCSTMED AS CUSTO_MEDIO,
PRODUTO.PRONCM AS COD_NCM,
PRODUTO.PROCEST AS PERSONAL6,
ESTOQUE.ESTATU AS QTD,
MIN(PRODUTOAUX.PROCODAUX) AS BARRAS
FROM PRODUTO
LEFT JOIN SECAO ON PRODUTO.SECCOD=SECAO.SECCOD
LEFT JOIN GENERO ON PRODUTO.GENCODIGO=GENERO.GENCODIGO
LEFT JOIN ESTOQUE ON PRODUTO.PROCOD=ESTOQUE.PROCOD
LEFT JOIN PRODUTOAUX ON PRODUTO.PROCOD=PRODUTOAUX.PROCOD
where produto.prodes is not NULL
GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

------------------------------------------------------------
SELECT PRODUTO.PROCOD AS COD_FABRICANTE,
PRODUTO.PRODES AS DESCRICAO,
SECAO.SECDES AS GRUPO,
PRODUTO.TRBID AS ST,
PRODUTO.PROUNID AS UND,
PRODUTO.PROPRC1 AS PRECO_VENDA,
PRODUTO.PROPRCCST AS PRECO_CUSTO,
PRODUTO.PRODATCADINC AS DATA_CADASTRO,
PRODUTO.PRODATCADALT AS ALTERACAO_PRECO,
PRODUTO.PROEND AS CARACTERISTICAS,
PRODUTO.PROUNDCMP AS UND_COMPRA,
PRODUTO.PROPRCCSTMED AS CUSTO_MEDIO,
PRODUTO.PRONCM AS COD_NCM,
PRODUTO.PROCEST AS PERSONAL6,
ESTOQUE.ESTATU AS QTD,
MIN(PRODUTOAUX.PROCODAUX) AS BARRAS
FROM PRODUTO
LEFT JOIN SECAO ON PRODUTO.SECCOD=SECAO.SECCOD
LEFT JOIN GENERO ON PRODUTO.GENCODIGO=GENERO.GENCODIGO
LEFT JOIN ESTOQUE ON PRODUTO.PROCOD=ESTOQUE.PROCOD
LEFT JOIN PRODUTOAUX ON PRODUTO.PROCOD=PRODUTOAUX.PROCOD
where produto.prodes is not NULL
GROUP BY 
PRODUTO.PROCOD,
PRODUTO.PRODES,
SECAO.SECDES,
PRODUTO.TRBID, 
PRODUTO.PROUNID, 
PRODUTO.PROPRC1,
PRODUTO.PROPRCCST,
PRODUTO.PRODATCADINC, 
PRODUTO.PRODATCADALT, 
PRODUTO.PROEND, 
PRODUTO.PROUNDCMP, 
PRODUTO.PROPRCCSTMED,
PRODUTO.PRONCM, 
PRODUTO.PROCEST, 
ESTOQUE.ESTATU 

------------------------------------------------------------

SELECT
SUBSTRING (PRODUTO.PROCOD FROM 9 FOR 14) AS CODIGO,
PRODUTO.PROCOD AS COD_FABRICANTE,
PRODUTO.PRODES AS DESCRICAO,
SECAO.SECDES AS GRUPO,
PRODUTO.TRBID AS ST,
PRODUTO.PROUNID AS UND,
PRODUTO.PROPRCVDAVAR AS PRECO_VENDA,
PRODUTO.PROPRCCST AS PRECO_CUSTO,
CAST (PRODUTO.PRODATCADINC AS DATE) AS DATA_CADASTRO,
CAST (PRODUTO.PRODATCADALT AS DATE) AS ALTERACAO_PRECO,
SUBSTRING (PRODUTO.PROCOD FROM 9 FOR 14) AS CARACTERISTICAS,
--PRODUTO.PROEND AS CARACTERISTICAS,
PRODUTO.PROUNDCMP AS UND_COMPRA,
PRODUTO.PROPRCCSTMED AS CUSTO_MEDIO,
PRODUTO.PRONCM AS COD_NCM,
PRODUTO.PROCEST AS PERSONAL6,
ESTOQUE.ESTATU AS QTD,
MIN(SUBSTRING (PRODUTOAUX.PROCODAUX FROM 2 FOR 14)) AS BARRAS
FROM PRODUTO
LEFT JOIN SECAO ON PRODUTO.SECCOD=SECAO.SECCOD
LEFT JOIN GENERO ON PRODUTO.GENCODIGO=GENERO.GENCODIGO
LEFT JOIN ESTOQUE ON PRODUTO.PROCOD=ESTOQUE.PROCOD
LEFT JOIN PRODUTOAUX ON PRODUTO.PROCOD=PRODUTOAUX.PROCOD
where produto.prodes is not NULL
GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16



-------script anterior, sem tratar o barras do produtos que vao para BALANCA-----------
SELECT
SUBSTRING (PRODUTO.PROCOD FROM 9 FOR 14) AS PERSONAL1,
SUBSTRING (PRODUTO.PROCOD FROM 1 FOR 14) AS COD_FABRICANTE,
MIN(SUBSTRING (PRODUTOAUX.PROCODAUX FROM 2 FOR 14)) AS BARRAS,
--MIN (SUBSTRING (PRODUTO.PROCOD FROM 2 FOR 14)) AS BARRAS,
--case when min(SUBSTRING (PRODUTOAUX.PROCODAUX FROM 2 FOR 14)) = '' or MIN(SUBSTRING (PRODUTOAUX.PROCODAUX FROM 2 FOR 14)) is null then SUBSTRING (PRODUTO.PROCOD FROM 2 FOR 14) else MIN(SUBSTRING (PRODUTOAUX.PROCODAUX FROM 2 FOR 14)) END AS BARRAS
--'2'||SUBSTRING (PRODUTO.PROCOD FROM 9 FOR 14) AS PERSONAL1, -- Ajustar com UPDATE posterior a conversão caso utilize produto pesado/balança
PRODUTO.PRODES AS DESCRICAO,
FORNECEDOR.FORDES AS FORNECEDOR,
GRUPO.GRPDES AS GRUPO,
S.SECDES AS CARACTERISTICAS,
PRODUTO.procodanp AS cod_anp,
SUBGRUPO.SGRDEs AS FAMILIA,
PRODUTO.TRBID AS ST,
PRODUTO.PROUNID AS UND,
produto.PROPESLIQ AS PESO,
PRODUTO.PROPRCVDAVAR AS PRECO_VENDA,
PRODUTO.PROPRCCST AS PRECO_CUSTO,
CAST (PRODUTO.PRODATCADINC AS DATE) AS DATA_CADASTRO,
CAST (PRODUTO.PRODATCADALT AS DATE) AS ALTERACAO_PRECO,
PRODUTO.PROUNDCMP AS UND_COMPRA,
PRODUTO.PROPRCCSTMED AS CUSTO_MEDIO,
PRODUTO.PRONCM AS COD_NCM,
PRODUTO.PROCEST AS PERSONAL6,
ESTOQUE.ESTATU AS QTD
, IFPIS.IMPFEDST AS PISE_CODIGO
, IFPIS.IMPFEDSTSAI as PIS_CODIGO
, IFPIS.IMPFEDALQ AS PISE_ALIQ_NOR
, IFPIS.IMPFEDALQSAI AS PIS_ALIQ_NOR
, IFCOFINS.IMPFEDST AS COFINSE_CODIGO
, IFCOFINS.IMPFEDSTSAI AS COFINS_CODIGO
, IFCOFINS.IMPFEDALQ AS COFINSE_ALIQ_NOR
, IFCOFINS.IMPFEDALQSAI AS COFINS_ALIQ_NOR
FROM PRODUTO
LEFT JOIN GENERO ON PRODUTO.GENCODIGO=GENERO.GENCODIGO
LEFT JOIN ESTOQUE ON PRODUTO.PROCOD=ESTOQUE.PROCOD
LEFT JOIN PRODUTOAUX ON PRODUTO.PROCOD=PRODUTOAUX.PROCOD
left join fornecedor on fornecedor.forcod = produto.forcod
left join grupo on grupo.grpcod = produto.grpcod and grupo.seccod = produto.seccod
left join subgrupo on subgrupo.sgrcod = produto.sgrcod and subgrupo.grpcod = produto.grpcod and subgrupo.seccod = produto.seccod
left join secao s on s.seccod = produto.seccod
LEFT JOIN IMPOSTOS_FEDERAIS_PRODUTO IFPPIS ON (IFPPIS.PROCOD = PRODUTO.PROCOD AND IFPPIS.IMPFEDSIM IN (SELECT IMPFEDSIM FROM IMPOSTOS_FEDERAIS WHERE IMPFEDTIP = 'P'))
LEFT JOIN IMPOSTOS_FEDERAIS IFPIS ON (IFPIS.IMPFEDSIM = IFPPIS.IMPFEDSIM AND IFPIS.IMPFEDTIP = 'P') 
LEFT JOIN IMPOSTOS_FEDERAIS_PRODUTO IFPCOFINS ON (IFPCOFINS.PROCOD = PRODUTO.PROCOD AND IFPCOFINS.IMPFEDSIM IN (SELECT IMPFEDSIM FROM IMPOSTOS_FEDERAIS WHERE IMPFEDTIP = 'C'))  
LEFT JOIN IMPOSTOS_FEDERAIS IFCOFINS ON (IFCOFINS.IMPFEDSIM = IFPCOFINS.IMPFEDSIM AND IFCOFINS.IMPFEDTIP = 'C') 
LEFT JOIN TRIBUTACAO ON TRIBUTACAO.TRBID = PRODUTO.TRBID INNER JOIN SECAO ON SECAO.SECCOD = PRODUTO.SECCOD 
where produto.prodes is not NULL
GROUP BY 1,2,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29

---------------------------------------------------------------------------
ULTIMO 02/01/2025

SELECT
    SUBSTRING(PRODUTO.PROCOD FROM 9 FOR 14) AS CODIGO,
    SUBSTRING(PRODUTO.PROCOD FROM 1 FOR 14) AS COD_FABRICANTE,
    CASE 
        WHEN PRODUTO.PROENVBAL = 'S' AND PRODUTO.PROUNID = 'KG' THEN '2'||SUBSTRING(PRODUTO.PROCOD FROM 9 FOR 14)
        ELSE MIN(SUBSTRING(PRODUTOAUX.PROCODAUX FROM 2 FOR 14))
    END AS BARRAS,
    PRODUTO.PROUNID AS UND,    
    PRODUTO.PRODES AS DESCRICAO,
    FORNECEDOR.FORDES AS FORNECEDOR,
    GRUPO.GRPDES AS GRUPO,
    S.SECDES AS CARACTERISTICAS,
    PRODUTO.PROCODANP AS COD_ANP,
    SUBGRUPO.SGRDES AS FAMILIA,
    PRODUTO.TRBID AS ST,
    PRODUTO.PROPESLIQ AS PESO,
    PRODUTO.PROPRCVDAVAR AS PRECO_VENDA,
    PRODUTO.PROPRCCST AS PRECO_CUSTO,
    CAST(PRODUTO.PRODATCADINC AS DATE) AS DATA_CADASTRO,
    CAST(PRODUTO.PRODATCADALT AS DATE) AS ALTERACAO_PRECO,
    case PRODUTO.proforlin WHEN 'S' then 'Inativo' else 'Ativo' end AS SITUACAO,
    PRODUTO.PROUNDCMP AS UND_COMPRA,
    PRODUTO.proprcvda2 AS PRECO_ATACADO,
    PRODUTO.PROPRCCSTMED AS CUSTO_MEDIO,
    PRODUTO.PRONCM AS COD_NCM,
    PRODUTO.PROCEST AS PERSONAL6,
    ESTOQUE.ESTATU AS QTD,
    IFPIS.IMPFEDST AS PISE_CODIGO,
    IFPIS.IMPFEDSTSAI AS PIS_CODIGO,
    IFPIS.IMPFEDALQ AS PISE_ALIQ_NOR,
    IFPIS.IMPFEDALQSAI AS PIS_ALIQ_NOR,
    IFCOFINS.IMPFEDST AS COFINSE_CODIGO,
    IFCOFINS.IMPFEDSTSAI AS COFINS_CODIGO,
    IFCOFINS.IMPFEDALQ AS COFINSE_ALIQ_NOR,
    IFCOFINS.IMPFEDALQSAI AS COFINS_ALIQ_NOR
FROM 
    PRODUTO
LEFT JOIN GENERO ON PRODUTO.GENCODIGO = GENERO.GENCODIGO
LEFT JOIN ESTOQUE ON PRODUTO.PROCOD = ESTOQUE.PROCOD
LEFT JOIN PRODUTOAUX ON PRODUTO.PROCOD = PRODUTOAUX.PROCOD
LEFT JOIN FORNECEDOR ON FORNECEDOR.FORCOD = PRODUTO.FORCOD
LEFT JOIN GRUPO ON GRUPO.GRPCOD = PRODUTO.GRPCOD AND GRUPO.SECCOD = PRODUTO.SECCOD
LEFT JOIN SUBGRUPO ON SUBGRUPO.SGRCOD = PRODUTO.SGRCOD AND SUBGRUPO.GRPCOD = PRODUTO.GRPCOD AND SUBGRUPO.SECCOD = PRODUTO.SECCOD
LEFT JOIN SECAO S ON S.SECCOD = PRODUTO.SECCOD
LEFT JOIN IMPOSTOS_FEDERAIS_PRODUTO IFPPIS ON (IFPPIS.PROCOD = PRODUTO.PROCOD AND IFPPIS.IMPFEDSIM IN (SELECT IMPFEDSIM FROM IMPOSTOS_FEDERAIS WHERE IMPFEDTIP = 'P'))
LEFT JOIN IMPOSTOS_FEDERAIS IFPIS ON (IFPIS.IMPFEDSIM = IFPPIS.IMPFEDSIM AND IFPIS.IMPFEDTIP = 'P') 
LEFT JOIN IMPOSTOS_FEDERAIS_PRODUTO IFPCOFINS ON (IFPCOFINS.PROCOD = PRODUTO.PROCOD AND IFPCOFINS.IMPFEDSIM IN (SELECT IMPFEDSIM FROM IMPOSTOS_FEDERAIS WHERE IMPFEDTIP = 'C'))  
LEFT JOIN IMPOSTOS_FEDERAIS IFCOFINS ON (IFCOFINS.IMPFEDSIM = IFPCOFINS.IMPFEDSIM AND IFCOFINS.IMPFEDTIP = 'C') 
LEFT JOIN TRIBUTACAO ON TRIBUTACAO.TRBID = PRODUTO.TRBID INNER JOIN SECAO ON SECAO.SECCOD = PRODUTO.SECCOD 
WHERE 
    PRODUTO.PRODES IS NOT NULL
GROUP BY 
    SUBSTRING(PRODUTO.PROCOD FROM 9 FOR 14),
    SUBSTRING(PRODUTO.PROCOD FROM 1 FOR 14),
    PRODUTO.PROENVBAL,
    PRODUTO.PROUNID,    
    PRODUTO.PRODES,
    FORNECEDOR.FORDES,
    GRUPO.GRPDES,
    S.SECDES,
    PRODUTO.PROCODANP,
    SUBGRUPO.SGRDES,
    PRODUTO.TRBID,
    PRODUTO.PROPESLIQ,
    PRODUTO.PROPRCVDAVAR,
    PRODUTO.proprcvda2,
    PRODUTO.proforlin,
    PRODUTO.PROPRCCST,
    CAST(PRODUTO.PRODATCADINC AS DATE),
    CAST(PRODUTO.PRODATCADALT AS DATE),
    PRODUTO.PROUNDCMP,
    PRODUTO.PROPRCCSTMED,
    PRODUTO.PRONCM,
    PRODUTO.PROCEST,
    ESTOQUE.ESTATU,
    IFPIS.IMPFEDST,
    IFPIS.IMPFEDSTSAI,
    IFPIS.IMPFEDALQ,
    IFPIS.IMPFEDALQSAI,
    IFCOFINS.IMPFEDST,
    IFCOFINS.IMPFEDSTSAI,
    IFCOFINS.IMPFEDALQ,
    IFCOFINS.IMPFEDALQSAI;
