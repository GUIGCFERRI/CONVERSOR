SELECT
    SUBSTRING (PRODUTOS.PRODUTO FROM 1 FOR 6) AS CODIGO,
    PRODUTOS.CODIGO2 AS BARRAS,
    PRODUTOS.DESCRICAO AS DESCRICAO,
    MARCAS.DESCRICAO AS CARACTERISTICAS,
    GRUPOS.DESCRICAO AS GRUPO,
    PRODUTOS.ESTOQUEMINIMO AS QTD_IDEAL,
    PROESTOQUE.QTDE AS QTD,
    PRODUTOS.UNIDADE AS UND,
    PRODUTOS.UNIDADEE AS UND_COMPRA, 
    PRODUTOS.PESOLIQUIDO AS PESO,
    SUBSTRING (TIPOALIQUOTA.DESCRICAO FROM 1 FOR 1) AS ST,
    MAX (PSC.PRECO) AS PRECO_CUSTO,
    PRODUTOS.MARGEM AS MARGEM_LUCRO,
    MAX (PSV.PRECO) AS PRECO_VENDA,
    PRODUTOS.OBS AS OBSERVACOES,
    CAST (PRODUTOS.DATAULTIMACOMPRA AS DATE) AS ULTIMA_COMPRA,
    CAST (PRODUTOS.DATA AS DATE) AS DATA_CADASTRO,
    PRODUTOS.NMERCOSUL AS COD_NCM,
    PRODUTOS.CEST AS PERSONAL6,
    MAX (PROFORN.CODIGO) AS COD_FABRICANTE
FROM PRODUTOS
LEFT JOIN PROESTOQUE ON PROESTOQUE.PRODUTO = PRODUTOS.PRODUTO
LEFT JOIN grupos ON GRUPOS.grupo = PRODUTOS.GRUPO
LEFT JOIN ALIQUOTA ON ALIQUOTA.situacaotributaria = PRODUTOS.ALIQUOTATRIBUTARIA
LEFT JOIN TIPOALIQUOTA ON TIPOALIQUOTA.idtipoaliquota = ALIQUOTA.situacaotributaria
LEFT JOIN PRECOS PSV ON PSV.PRODUTO = PRODUTOS.PRODUTO AND PSV.TIPOVENDA = '1'
LEFT JOIN PRECOS PSC ON PSC.PRODUTO = PRODUTOS.PRODUTO AND PSC.TIPOVENDA = '100'
LEFT JOIN MARCAS ON MARCAS.MARCA = PRODUTOS.MARCA
LEFT JOIN PROFORN ON PROFORN.PRODUTO = PRODUTOS.PRODUTO
LEFT JOIN TIPOVENDA ON TIPOVENDA.tipovenda = PSV.TIPOVENDA
--WHERE PROESTOQUE.FILIAL = '1'
GROUP BY 1,2,3,4,5,6,7,8,9,10,11,13,15,16,17,18,19